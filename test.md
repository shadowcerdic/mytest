<div dir="rtl" align="right">

<h2>درک عمیق فرآیندهای System و Memory Compression در ویندوز</h2>

<p>در معماری سیستم‌عامل ویندوز، فرآیندهای خاصی وجود دارند که درک آن‌ها برای مدیریت، بهینه‌سازی و امنیت سیستم حیاتی است. دو مورد از مهم‌ترین و در عین حال گاهی مبهم‌ترینِ این فرآیندها، «System» و «Memory Compression» هستند.</p>

<h3>فرآیند System (PID 4): قلب تپنده کرنل</h3>

<p>فرآیند <b>System</b> با شناسه فرآیند (PID) ثابت 4، یکی از اصلی‌ترین و بنیادی‌ترین موجودیت‌ها در هسته (Kernel) ویندوز است. این فرآیند، یک فرآیند واقعی در فضای کاربر (User Space) مانند سایر برنامه‌ها نیست؛ بلکه در ابزارهایی مانند Task Manager، بازتابی از تمام فعالیت‌ها و تِرِدهای در حال اجرا در حالت هسته (Kernel Mode Threads) است.</p>
<p>این فرآیند در واقع نمایانگر عملکرد خودِ هسته ویندوز (فایل <code>ntoskrnl.exe</code>) بوده و مسئولیت اجرای روتین‌های وقفه (Interrupt Routines) و روندهای زمان‌بندی (Scheduling) را بر عهده دارد.</p>

<h4>ویژگی‌های کلیدی فرآیند System</h4>
<ul style="direction: rtl; text-align: right; list-style-position: inside;">
    <li><b>PID:</b> همیشه و به صورت ثابت 4 است </li>
    <li><b>مالک:</b> تحت حساب کاربری Local System اجرا می‌شود </li>
    <li><b>والد (Parent):</b> هیچ (خود هسته سیستم‌عامل است) </li>
    <li><b>فرزند (Child):</b> در یک سیستم سالم، فرآیند System تنها و فقط یک فرآیند فرزند به نام <code>smss.exe</code> (Session Manager Subsystem) دارد </li>
    <li><b>مسیر اجرایی:</b> نمایش مسیر این فرآیند در ابزارهای مختلف متفاوت است؛ در Task Manager معمولاً <code>ntoskrnl.exe</code> و در Process Explorer به عنوان "None" نمایش داده می‌شود </li>
</ul>

<h4>وظایف اصلی</h4>
<p>فرآیند System میزبان تمامی تردهای کرنلی است که وظایف حیاتی سیستم را مدیریت می‌کنند، از جمله:</p>
<ul>
    <li><b>مدیریت حافظه (Memory Manager Threads):</b> برای تخصیص حافظه در Kernel Pool.</li>
    <li><b>عملیات ورودی/خروجی (I/O Workers):</b> برای کنترل دیسک و شبکه.</li>
    <li><b>توزیع بار پردازشی (Balancer Threads):</b> برای متعادل‌سازی بار کاری بین هسته‌های CPU.</li>
    <li><b>ارتباطات بین پردازشی (IPC):</b> مدیریت System Calls، DPCs و Interrupts.</li>
</ul>

<h4>نشانه‌های نفوذ (IoC) مرتبط با فرآیند System</h4>
<p>به دلیل ماهیت بنیادین این فرآیند، هرگونه ناهنجاری در رفتار آن می‌تواند نشانه‌ای قوی از یک نفوذ در سطح کرنل (مانند Rootkit) باشد:</p>
<ul>
    <li><b>فرزندان مشکوک:</b> مشاهده هر فرآیند فرزندی به‌جز <code>smss.exe</code>، یک پرچم قرمز جدی است.</li>
    <li><b>بیش از یک نمونه:</b> وجود بیش از یک فرآیند System (PID 4).</li>
    <li><b>فعالیت شبکه:</b> شنود (Listening) بر روی پورت‌هایی مانند 80 یا 443، که می‌تواند نشانه‌ی تزریق کد به درایور <code>HTTP.sys</code> باشد.</li>
    <li><b>مصرف منابع:</b> مصرف غیرعادی و بالای CPU توسط PID 4 در زمانی که سیستم بیکار است.</li>
</ul>

<h3>فرآیند Memory Compression: بهینه‌ساز حافظه مدرن</h3>

<p>فرآیند <b>Memory Compression</b> یکی از قابلیت‌های نسبتاً جدید است که از ویندوز 10 (Build 10586) به بعد معرفی شد. این فرآیند یک موجودیت مینیمال و تخصصی است که با هدف بهبود عملکرد و زمان پاسخ‌دهی سیستم، به‌خصوص در زمان کمبود حافظه فیزیکی (RAM)، طراحی شده است.</p>

<h4>عملکرد و هدف</h4>
<p>در گذشته، زمانی که RAM سیستم پر می‌شد، ویندوز داده‌های غیرفعال را به فایل صفحه‌بندی (Page File) روی دیسک سخت (HDD/SSD) منتقل می‌کرد. این فرآیند (Paging) به دلیل کُند بودن دیسک نسبت به حافظه، باعث افت شدید عملکرد می‌شد.</p>
<p>فرآیند Memory Compression این چرخه را بهینه‌سازی می‌کند. به جای انتقال مستقیم داده‌ها به دیسک، ابتدا سعی می‌کند بخش‌هایی از حافظه فرآیندهای غیرفعال را درون خودِ RAM فشرده‌سازی کند. این کار فضای خالی در RAM ایجاد می‌کند و نیاز به مراجعه به دیسک را به شدت کاهش می‌دهد.</p>

<h4>ویژگی‌های کلیدی</h4>
<ul>
    <li><b>والد (Parent):</b> این فرآیند فرزند فرآیند System (PID 4) محسوب می‌شود.</li>
    <li><b>فرزند (Child):</b> هیچ فرآیند فرزندی ندارد.</li>
    <li><b>مالک:</b> تحت حساب کاربری Local System اجرا می‌شود.</li>
    <li><b>تعداد:</b> همیشه تنها یک نمونه از آن در سیستم فعال است.</li>
    <li><b>عملکرد داخلی:</b> این فرآیند بخشی از مدیریت حافظه (Memory Manager) در کرنل است و از ساختاری به نام Store Manager برای نگهداری صفحات فشرده (SMKM_STORE) استفاده می‌کند.</li>
</ul>

<h4>جنبه‌های امنیتی و تحلیل</h4>
<p>از آنجایی که این فرآیند نسبتاً جدید است، گاهی ممکن است تحلیلگران تازه‌کار آن را با بدافزار اشتباه بگیرند. با این حال، مهاجمان پیشرفته نیز می‌توانند از این مکانیزم سوءاستفاده کنند.</p>
<p><b>پنهان‌سازی Payload:</b> گزارش‌هایی (مانند تحلیل‌های Google Threat Analysis) نشان می‌دهد که بدافزارهای سطح کرنل می‌توانند داده‌ها یا کدهای مخرب (Payload) خود را درون حافظه فشرده‌شده پنهان کنند تا از دید ابزارهای امنیتی پنهان بمانند.</p>
<p><b>نشانه‌های نفوذ (IoC):</b></p>
<ul>
    <li>وجود بیش از یک نمونه از فرآیند "Memory Compression".</li>
    <li>مشاهده هرگونه فعالیت شبکه‌ای یا دسترسی مستقیم به I/O دیسک توسط این فرآیند.</li>
    <li>افزایش ناگهانی و شدید حجم حافظه فشرده‌شده در زمانی که سیستم بیکار است.</li>
</ul>

</div>
