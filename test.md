<div dir="rtl" align="right">

<h2>درک عمیق فرآیندهای System و Memory Compression در ویندوز</h2>

<p>در معماری سیستم‌عامل ویندوز، فرآیندهای خاصی وجود دارند که درک آن‌ها برای مدیریت، بهینه‌سازی و امنیت سیستم ضروری است. دو مورد از این فرآیندهای کلیدی، <b>System (PID 4)</b> و <b>Memory Compression</b> هستند که نقش‌های حیاتی در عملکرد سیستم ایفا می‌کنند.</p>

<h3>فرآیند System (PID 4): قلب تپنده کرنل</h3>

<p>فرآیند <b>System</b> با شناسه فرآیند (PID) ثابت 4، یکی از اصلی‌ترین و بنیادی‌ترین موجودیت‌ها در هسته (Kernel) ویندوز است.</p>
<p>این فرآیند در واقع نمایانگر عملکرد خودِ هسته ویندوز (فایل <code>ntoskrnl.exe</code>) بوده و مسئولیت اجرای روتین‌های وقفه (Interrupt Handlers)، تردهای کرنلی (Kernel Threads) و درایورهای سطح هسته (Kernel-Mode Drivers) را بر عهده دارد.</p>

<h4>ویژگی‌های کلیدی فرآیند System</h4>

<ul dir="rtl">
    <li><b>PID:</b> همیشه و به صورت ثابت 4 است </li>
    <li><b>مالک:</b> تحت حساب کاربری Local System اجرا می‌شود </li>
    <li><b>والد (Parent):</b> هیچ (خود هسته سیستم‌عامل است) </li>
    <li><b>فرزند (Child):</b> در یک سیستم سالم، فرآیند System تنها و فقط یک فرآیند فرزند به نام <code>smss.exe</code> (Session Manager Subsystem) دارد.</li>
    <li><b>مسیر اجرایی:</b> نمایش مسیر این فرآیند در ابزارهای مختلف متفاوت است؛ در Task Manager معمولاً <code>ntoskrnl.exe</code> و در Process Explorer ممکن است به شکل دیگری نمایش داده شود.</li>
</ul>

<h4>وظایف اصلی</h4>
<p>فرآیند System میزبان تمامی تردهای کرنلی است که وظایف حیاتی سیستم را مدیریت می‌کنند، از جمله:</p>
<ul>
    <li><b>مدیریت حافظه (Memory Manager Threads):</b> برای تخصیص حافظه در Kernel Pool.</li>
    <li><b>عملیات ورودی/خروجی (I/O Workers):</b> برای کنترل دیسک و شبکه.</li>
    <li><b>توزیع بار پردازشی (Balancer Threads):</b> برای متعادل‌سازی بار کاری بین هسته‌های CPU.</li>
    <li><b>ارتباطات بین پردازشی (IPC):</b> مدیریت System Calls، DPCs و Interrupts.</li>
</ul>

<h4>نشانه‌های نفوذ (IoC) مرتبط با فرآیند System</h4>
<p>به دلیل ماهیت بنیادین این فرآیند، هرگونه ناهنجاری در رفتار آن می‌تواند نشانه‌ای قوی از یک نفوذ در سطح کرنل (Kernel-Level Compromise) باشد:</p>
<ul>
    <li><b>فرزندان مشکوک:</b> مشاهده هر فرآیند فرزندی به‌جز <code>smss.exe</code>، یک پرچم قرمز جدی است.</li>
    <li><b>بیش از یک نمونه:</b> وجود بیش از یک فرآیند System (PID 4).</li>
    <li><b>فعالیت شبکه:</b> شنود (Listening) بر روی پورت‌هایی مانند 80 یا 443، که می‌تواند نشانه‌ی تزریق کد به درایور <code>HTTP.sys</code> باشد.</li>
    <li><b>مصرف منابع:</b> مصرف غیرعادی و بالای CPU توسط PID 4 در زمانی که سیستم بیکار است.</li>
</ul>

<h3>فرآیند Memory Compression: بهینه‌ساز حافظه مدرن</h3>

<p>فرآیند <b>Memory Compression</b> یکی از قابلیت‌های نسبتاً جدید است که از ویندوز 10 (Build 10586) به بعد معرفی شد. این فرآیند یک اجزای جدایی‌ناپذیر از مدیریت حافظه (Memory Management) مدرن در ویندوز محسوب می‌شود.</p>

<h4>عملکرد و هدف</h4>
<p>در گذشته، زمانی که RAM سیستم پر می‌شد، ویندوز داده‌های غیرفعال را به فایل صفحه‌بندی (Page File) روی دیسک سخت (HDD/SSD) منتقل می‌کرد. این فرآیند نسبتاً کند بود و می‌توانست باعث کاهش چشمگیر کارایی شود.</p>
<p>فرآیند Memory Compression این چرخه را بهینه‌سازی می‌کند. به جای انتقال مستقیم داده‌ها به دیسک، ابتدا سعی می‌کند بخش‌هایی از حافظه که به ندرت استفاده می‌شوند را فشرده‌سازی (Compress) کند. این کار باعث می‌شود داده‌ها همچنان در RAM باقی بمانند، اما فضای کمتری اشغال کنند.</p>

<h4>ویژگی‌های کلیدی</h4>
<ul>
    <li><b>والد (Parent):</b> این فرآیند فرزند فرآیند System (PID 4) محسوب می‌شود.</li>
    <li><b>فرزند (Child):</b> هیچ فرآیند فرزندی ندارد.</li>
    <li><b>مالک:</b> تحت حساب کاربری Local System اجرا می‌شود.</li>
    <li><b>تعداد:</b> همیشه تنها یک نمونه از آن در سیستم فعال است.</li>
    <li><b>عملکرد داخلی:</b> این فرآیند بخشی از مدیریت حافظه (Memory Manager) در کرنل است و از ساختاری به نام Store Manager برای نگهداری صفحات فشرده‌شده استفاده می‌کند.</li>
</ul>

<h4>جنبه‌های امنیتی و تحلیل</h4>
<p>از آنجایی که این فرآیند نسبتاً جدید است، گاهی ممکن است تحلیلگران تازه‌کار آن را با بدافزار اشتباه بگیرند. با این حال، درک نشانه‌های نفوذ واقعی ضروری است:</p>
<p><b>پنهان‌سازی Payload:</b> گزارش‌هایی (مانند تحلیل‌های Google Threat Analysis) نشان می‌دهد که بدافزارهای سطح کرنل می‌توانند در حافظه فشرده‌شده پنهان شوند و از تشخیص ابزارهای امنیتی فرار کنند.</p>
<p><b>نشانه‌های نفوذ (IoC):</b></p>
<ul>
    <li>وجود بیش از یک نمونه از فرآیند "Memory Compression".</li>
    <li>مشاهده هرگونه فعالیت شبکه‌ای یا دسترسی مستقیم به I/O دیسک توسط این فرآیند.</li>
    <li>افزایش ناگهانی و شدید حجم حافظه فشرده‌شده در زمانی که سیستم بیکار است.</li>
</ul>

<h3>دستورات PowerShell عملی برای نظارت بر فرآیندهای System و Memory Compression</h3>
<p>در زیر چند دستور PowerShell برای نظارت بر فرآیندهای System و Memory Compression آورده شده است:</p>
<pre><code>Get-Process -Name "System" | Select-Object Id, ProcessName, CPU, WS
Get-Process -Name "Memory Compression" | Select-Object Id, ProcessName, CPU, WS
</code></pre>

<h3>راهنمای تحلیل Process Explorer، Sysmon و Volatility</h3>
<p>ابزارهای زیر برای تحلیل و نظارت بر رفتار سیستم استفاده می‌شوند:</p>
<ul>
    <li><b>Process Explorer:</b> ابزاری برای نمایش فرآیندهای در حال اجرا و نظارت بر رفتار آن‌ها.</li>
    <li><b>Sysmon:</b> ابزاری برای نظارت بر رویدادهای سیستم و ثبت اطلاعات مربوط به آن‌ها.</li>
    <li><b>Volatility:</b> ابزاری برای تحلیل حافظه و استخراج اطلاعات از حافظه فعلی سیستم.</li>
</ul>

<h3>سناریوهای حمله واقعی و مطالعات موردی</h3>
<p>در این بخش، به بررسی سناریوهای حمله واقعی و مطالعات موردی خواهیم پرداخت که در آن‌ها از فرآیندهای System و Memory Compression به عنوان هدف استفاده شده است.</p>

<h3>جدول مقایسه رفتار عادی و مشکوک</h3>
<p>جدولی برای مقایسه رفتار عادی و مشکوک فرآیندهای System و Memory Compression:</p>
<table>
    <tr>
        <th>نوع رفتار</th>
        <th>رفتار عادی</th>
        <th>رفتار مشکوک</th>
    </tr>
    <tr>
        <td>مصرف CPU</td>
        <td>کم و پایدار</td>
        <td>بالا و غیرعادی</td>
    </tr>
    <tr>
        <td>فعالیت شبکه</td>
        <td>بدون فعالیت</td>
        <td>شنود بر روی پورت‌های حساس</td>
    </tr>
</table>

<h3>چک‌لیست‌های امنیتی برای تحلیلگران و مدیران سیستم</h3>
<p>چک‌لیست‌هایی برای ارزیابی امنیتی فرآیندهای System و Memory Compression:</p>
<ul>
    <li>نظارت بر نشانه‌های نفوذ (IoC) مربوط به فرآیندها.</li>
    <li>تحلیل ترافیک شبکه‌ای و مصرف منابع.</li>
</ul>

<h3>جزئیات فنی عمیق در مورد معماری کرنل (EPROCESS، PsLoadedModuleList)</h3>
<p>در این بخش، جزئیات فنی عمیق در مورد ساختار EPROCESS و PsLoadedModuleList ارائه خواهد شد.</p>

<h3>روش‌های تشخیص Rootkit (DKOM، SSDT Hooking، IRP Hooking)</h3>
<p>روش‌های مختلفی برای تشخیص Rootkitها وجود دارد که شامل DKOM، SSDT Hooking و IRP Hooking می‌شود.</p>

<h3>تحلیل حافظه با مثال‌های Volatility</h3>
<p>مثال‌هایی از تحلیل حافظه با استفاده از ابزار Volatility:</p>
<pre><code>volatility -f memory_dump.raw --profile=Win10x64 pslist
volatility -f memory_dump.raw --profile=Win10x64 dlllist
</code></pre>

<h3>توضیحات نمودار جریان خط لوله فشرده‌سازی حافظه</h3>
<p>در این بخش، شرحی از نمودار جریان خط لوله فشرده‌سازی حافظه ارائه خواهد شد.</p>

<h3>بررسی ابزارهای مجموعه Sysinternals</h3>
<p>این بخش به بررسی ابزارهای مجموعه Sysinternals خواهد پرداخت که برای مدیریت و تحلیل سیستم استفاده می‌شوند.</p>

<h3>اسکریپت‌های PowerShell برای نظارت در زمان واقعی</h3>
<p>در زیر چند اسکریپت PowerShell برای نظارت در زمان واقعی آورده شده است:</p>
<pre><code>while ($true) {
    Get-Process -Name "System" | Select-Object Id, CPU, WS
    Start-Sleep -Seconds 5
}
</code></pre>

<h3>مطالعات موردی بدافزارهایی که از این فرآیندها بهره‌برداری کرده‌اند</h3>
<p>در این بخش، مطالعات موردی از بدافزارهایی که از فرآیندهای System و Memory Compression بهره‌برداری کرده‌اند، بررسی خواهد شد.</p>

<h3>منابع اضافی و لینک‌های مستندات مایکروسافت</h3>
<p>در این بخش، منابع اضافی و لینک‌های مستندات مایکروسافت ارائه خواهد شد.</p>

<h3>توضیحات نمودارهای معماری کرنل</h3>
<p>این بخش به توضیحات نمودارهای معماری کرنل اختصاص دارد.</p>

<h3>روش‌های تحلیل گام‌به‌گام</h3>
<p>در این بخش، روش‌های تحلیل گام‌به‌گام فرآیندهای System و Memory Compression ارائه خواهد شد.</p>

<h3>سوالات پیکربندی Sysmon</h3>
<p>در اینجا به سوالات پیکربندی Sysmon پرداخته خواهد شد.</p>

<h3>نقشه‌برداری چارچوب MITRE ATT&CK</h3>
<p>در این بخش، نقشه‌برداری چارچوب MITRE ATT&CK از حملات مرتبط با فرآیندهای System و Memory Compression بررسی خواهد شد.</p>

</div>