<div dir="rtl" align="right">

<h2>فرآیند smss.exe: دروازه‌بان نشست‌های کاربری ویندوز</h2>

<p>فرآیند <b>Session Manager Subsystem</b> (با نام فایل <b>smss.exe</b>) یکی از حیاتی‌ترین مؤلفه‌های سیستم‌عامل ویندوز و در واقع <i>اولین فرآیند حالت کاربر (User Mode)</i> است که پس از راه‌اندازی هسته (Kernel) توسط فرآیند <b>System (PID 4)</b> ایجاد می‌شود. این فرآیند نقش کلیدی در راه‌اندازی سیستم و آماده‌سازی محیط برای نشست‌های کاربری ایفا می‌کند.</p>

<p>مسیر اجرایی این فرآیند همواره در <code>C:\Windows\System32\smss.exe</code> (یا <code>%SystemRoot%\System32\smss.exe</code>) قرار دارد و تحت حساب کاربری <code>Local System</code> اجرا می‌شود.</p>

<h3>وظایف اصلی و حیاتی</h3>

<p><code>smss.exe</code> مسئولیت‌های بنیادین متعددی را در مراحل اولیه بوت بر عهده دارد:</p>
<ul>
    <li><b>ایجاد متغیرهای محیطی (Environment Variables):</b> متغیرهای سیستمی را با خواندن مقادیر از رجیستری (به‌ویژه <code>HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Environment</code>) تنظیم می‌کند.</li>
    <li><b>مقداردهی اولیه رجیستری:</b> هایوهای (Hives) حیاتی رجیستری مانند <code>HKLM\SAM</code>، <code>HKLM\SECURITY</code> و <code>HKLM\SOFTWARE</code> را مقداردهی اولیه می‌کند.</li>
    <li><b>مدیریت فایل صفحه‌بندی (Page File):</b> فایل <code>Pagefile.sys</code> را برای مدیریت حافظه مجازی ایجاد می‌کند.</li>
    <li><b>بارگذاری زیرسیستم Win32:</b> زیرسیستم <code>Win32k.sys</code> (در حالت هسته) و <code>csrss.exe</code> (در حالت کاربر) را راه‌اندازی می‌کند تا محیط گرافیکی و APIهای سطح کاربر فراهم شوند.</li>
    <li><b>اجرای وظایف پیش‌راه‌اندازی:</b> ابزارهایی مانند <code>autochk.exe</code> (برای بررسی سلامت فایل‌سیستم) را قبل از بوت کامل اجرا می‌کند.</li>
    <li><b>ایجاد نشست‌ها (Sessions):</b> مهم‌ترین وظیفه آن، ایجاد نشست‌های کاربری است.</li>
</ul>

<h3>ساختار نمونه‌ها: معماری "Master" و "Child"</h3>

<p>نحوه عملکرد <code>smss.exe</code> اغلب باعث سردرگمی می‌شود، اما ساختار مشخصی دارد:</p>
<ol>
    <li><b>نمونه اصلی (Master Instance):</b> یک نمونه اصلی و دائمی از <code>smss.exe</code> وجود دارد که پس از بوت در حافظه باقی می‌ماند. مشخصه اصلی این نمونه، <i>عدم وجود هرگونه آرگومان خط فرمان (Command Line Arguments)</i> است.</li>
    <li><b>نمونه‌های فرزند (Temporary Instances):</b> این نمونه اصلی، به ازای هر نشست جدید، یک کپی موقتی (فرزند) از خود ایجاد می‌کند.
        <ul>
            <li><b>Session 0 (نشست سیستمی):</b> اولین فرزند برای نشست صفر ایجاد شده و مسئول راه‌اندازی فرآیندهای سیستمی حیاتی یعنی <b><code>wininit.exe</code></b> و <b><code>csrss.exe</code></b> (مربوط به نشست صفر) است.</li>
            <li><b>Session 1 (نشست کاربر):</b> فرزند بعدی برای نشست اولین کاربر (Session 1) ایجاد شده و مسئول راه‌اندازی <b><code>winlogon.exe</code></b> (فرآیند لاگین کاربر) و <b><code>csrss.exe</code></b> مربوط به آن نشست است.</li>
        </ul>
    </li>
    <li><b>خاتمه فرزندان:</b> پس از اینکه این نمونه‌های موقت وظایف خود (ایجاد <code>wininit</code>, <code>winlogon</code> و <code>csrss</code>) را انجام دادند، خاتمه می‌یابند.</li>
</ol>
<p>بنابراین، در یک سیستم در حال کار، تنها <i>یک</i> نمونه اصلی و پایدار از <code>smss.exe</code> باید فعال باشد.</p>

<h3>نشانه‌های نفوذ (IoC) و تحلیل امنیتی</h3>

<p>از دید امنیتی، <code>smss.exe</code> به دلیل نقش حیاتی خود، هدفی محبوب برای مهاجمان است. هرگونه رفتار غیرعادی می‌تواند نشانه‌ای از نفوذ یا بدافزار باشد:</p>
<ul>
    <li><b>مسیر اجرایی نادرست:</b> وجود فایلی با این نام در هر مسیری <i>غیر از</i> <code>C:\Windows\System32</code>.</li>
    <li><b>والد اشتباه:</b> والد <code>smss.exe</code> <i>همیشه</i> باید <b>System (PID 4)</b> باشد. هر والد دیگری (مانند <code>explorer.exe</code> یا <code>services.exe</code>) نشانه‌ی قطعی نفوذ است.</li>
    <li><b>تعداد نمونه‌ها:</b> وجود <i>بیش از یک</i> نمونه پایدار از <code>smss.exe</code> (که آرگومان خط فرمان نداشته باشد) بسیار مشکوک است.</li>
    <li><b>جعل نام (Masquerading):</b> مهاجمان اغلب بدافزارهایی با نام‌های بسیار مشابه مانند <code>smsss.exe</code> (با s اضافه)، <code>smss32.exe</code> یا <code>sms.exe</code> ایجاد می‌کنند تا از دید تحلیلگران پنهان بمانند.</li>
    <li><b>فعالیت شبکه:</b> این فرآیند ذاتاً هیچ نیازی به ارتباط شبکه‌ای ندارد. هرگونه فعالیت شبکه‌ای از جانب <code>smss.exe</code> یک پرچم قرمز جدی است.</li>
    <li><b>امضای دیجیتال:</b> فرآیند اصلی باید دارای امضای دیجیتال معتبر «Microsoft Windows Publisher» باشد.</li>
</ul>

</div>
